# Lab1: RISC-V ASM

Отчет по первой лабораторной работе

## Вариант задания

Вариант 2

Вариант задания | Передача параметров
--------------- | -------------
Найти индекс максимального элемента массива.<br>(N=4, M=3) | Через стек

## Сборка

Сборка Си файла выполняется с помощью GNU Make. Для этого необходимо выполнить команду

```
make
```

## Результаты работы

+ **lab1.S** - программа на языке ассемблера RISCV
+ **main.c** - программа на Си
+ **main.dump** - дамп-файл программы на Си
+ **makefile** - файл для сборки

## Выполнение работы

Корректность выполнения работы *lab1.S* можно проверить с помощью симулятора [Venus](https://www.kvakil.me/venus/), изменяя данные матрицы

```
matrix:
.word -10, -5, -3, -4
.word -5, -15, -7, -8
.word -9, -10, -11, -12
```
## Анализ дамп-файла

Начало вызываемой процедуры *findMax*

```
0010140 <findMax>:
   10140:	fd010113          	addi	sp,sp,-48
```
Ниже сразу идет процедура *main*

```
000101f0 <main>:
   101f0:	fb010113          	addi	sp,sp,-80
```
### Анализ main

В начале изменяется значение *sp*, значения из *s0* и *ra* сохраняются на стеке, а в конце восстанавливаются, так как callee обязан восстанавливать их в конце процедуры

```
   101f0:	fb010113          	addi	sp,sp,-80
   101f4:	04112623          	sw	ra,76(sp)
   101f8:	04812423          	sw	s0,72(sp)
```

```
   1029c:	04c12083          	lw	ra,76(sp)
   102a0:	04812403          	lw	s0,72(sp)
   102a4:	05010113          	addi	sp,sp,80
```

---

Аргументы в findMax передаются через регистры *a0, a1, a2*, где *a5* содержит адрес первого элемента матрицы

```
   10270:	00078613          	mv	a2,a5
   10274:	00300593          	li	a1,3
   10278:	00400513          	li	a0,4
   1027c:	ec5ff0ef          	jal	ra,10140 <findMax>
```

### Анализ findMax

Как и в *main*, значения *sp* и *s0* изменяются в начале и восстанавливаются в конце

```
   10140:	fd010113          	addi	sp,sp,-48
   10144:	02812623          	sw	s0,44(sp)
```

```
   101e4:	02c12403          	lw	s0,44(sp)
   101e8:	03010113          	addi	sp,sp,48
```
---
Для перебора элементов массива и выбора наибольшего элемента используется три условных команды

+ Сравнение текущего максимального значений и текущего элемента массива

```
   101a0:	00e7d663          	bge	a5,a4,101ac <findMax+0x6c>
```

+ Сравнение для перебора по элементам строки

```
   101c0:	faf74ae3          	blt	a4,a5,10174 <findMax+0x34>
```

+ Сравнение для перебора строк

```
   101d8:	f8f74ae3          	blt	a4,a5,1016c <findMax+0x2c>
```

---

В регистре *a5* хранится возвращаемое значение, которое в конце процедуры будет записано в регистр *a0*

```
   101e0:	00078513          	mv	a0,a5
```

## Вывод
Ожидание более часа, пока соберется компилятор, просто невероятно.
